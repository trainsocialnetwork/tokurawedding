<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Story Quest - ÁµêÂ©öÁ•ù„ÅÑRPG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: 'Courier New', monospace;
    }
    
    #gameContainer {
        position: relative;
        background: #000;
        box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }
    
    canvas {
        display: block;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
    }
    
    #dialogueBox {
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
        background: linear-gradient(to bottom, #2c3e50, #34495e);
        border: 3px solid #ecf0f1;
        border-radius: 10px;
        padding: 20px;
        color: white;
        font-size: 18px;
        line-height: 1.6;
        display: none;
        z-index: 10;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    
    #dialogueBox.active {
        display: block;
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
        from {
            transform: translateY(100px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    #speakerName {
        color: #f39c12;
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 20px;
    }
    
    #quizOptions {
        margin-top: 15px;
        display: none;
    }
    
    .quizButton {
        display: block;
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        background: linear-gradient(to right, #3498db, #2980b9);
        color: white;
        border: 2px solid #ecf0f1;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
        font-family: inherit;
    }
    
    .quizButton:hover {
        background: linear-gradient(to right, #e74c3c, #c0392b);
        transform: translateX(5px);
    }
    
    #startScreen {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 20;
    }
    
    #startScreen h1 {
        color: white;
        font-size: 48px;
        margin-bottom: 20px;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    #startButton {
        padding: 15px 40px;
        font-size: 24px;
        background: linear-gradient(to right, #f39c12, #e67e22);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        transition: all 0.3s;
        font-family: inherit;
    }
    
    #startButton:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    
    #stageTitle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 36px;
        text-align: center;
        z-index: 15;
        display: none;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
        background: rgba(0,0,0,0.7);
        padding: 20px 40px;
        border-radius: 10px;
        border: 3px solid gold;
    }
    
    #controls {
        position: absolute;
        top: 10px;
        right: 10px;
        color: white;
        background: rgba(0,0,0,0.7);
        padding: 10px;
        border-radius: 5px;
        font-size: 14px;
        z-index: 5;
    }
    
    #endScreen {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 25;
        color: white;
        text-align: center;
        padding: 20px;
    }
    
    #endScreen h1 {
        font-size: 48px;
        margin-bottom: 20px;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
    }
    
    #endScreen p {
        font-size: 24px;
        margin: 10px 0;
    }
    
    #restartButton {
        margin-top: 30px;
        padding: 15px 40px;
        font-size: 20px;
        background: linear-gradient(to right, #11998e, #38ef7d);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        font-family: inherit;
    }
    
    #restartButton:hover {
        transform: scale(1.1);
    }
</style>
```

</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>

```
    <div id="controls">
        Êìç‰Ωú: Áü¢Âç∞„Ç≠„Éº or WASD „ÅßÁßªÂãï<br>
        „Çπ„Éö„Éº„Çπ or Enter „ÅßË©±„Åô/Ê±∫ÂÆö
    </div>
    
    <div id="dialogueBox">
        <div id="speakerName"></div>
        <div id="dialogueText"></div>
        <div id="quizOptions"></div>
    </div>
    
    <div id="stageTitle"></div>
    
    <div id="startScreen">
        <h1>üíç Wedding Story Quest üíç</h1>
        <p style="color: white; margin-bottom: 30px; font-size: 20px;">‰∫å‰∫∫„ÅÆÊÑõ„ÅÆÁâ©Ë™û„ÇíËøΩ‰ΩìÈ®ì„Åó„Çà„ÅÜÔºÅ</p>
        <button id="startButton">„Ç≤„Éº„É†„Çπ„Çø„Éº„Éà</button>
    </div>
    
    <div id="endScreen">
        <h1>üéä Congratulations! üéä</h1>
        <p>ÂÖ®„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ</p>
        <p id="finalScore"></p>
        <p style="margin-top: 20px; font-size: 18px;">Êú´Ê∞∏„Åè„ÅäÂπ∏„Åõ„Å´ÔºÅ</p>
        <button id="restartButton">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 800;
    canvas.height = 600;
    
    // „Ç≤„Éº„É†Áä∂ÊÖãÁÆ°ÁêÜ
    const game = {
        currentStage: 0,
        score: 0,
        totalQuestions: 4,
        isDialogueActive: false,
        isQuizActive: false,
        currentDialogue: null,
        dialogueIndex: 0
    };
    
    // „Éó„É¨„Ç§„É§„Éº
    const player = {
        x: 400,
        y: 400,
        width: 32,
        height: 48,
        speed: 4,
        direction: 'down',
        isMoving: false,
        frameCount: 0,
        currentFrame: 0
    };
    
    // „Çπ„ÉÜ„Éº„Ç∏„Éá„Éº„Çø
    const stages = [
        {
            name: "Stage 1: „Éû„ÉÉ„ÉÅ„É≥„Ç∞„Ç¢„Éó„É™",
            bgColor: "#e8f5e9",
            npcs: [
                {
                    name: "Âèã‰∫∫A",
                    x: 300,
                    y: 200,
                    dialogue: [
                        "„ÇÑ„ÅÇÔºÅÊúÄËøë„Å©„ÅÜÔºü",
                        "ÂÆü„ÅØ„Åï„ÄÅ„Åô„Åî„Åè„ÅÑ„ÅÑ„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Ç¢„Éó„É™„Åå„ÅÇ„Çã„Çì„Å†ÔºÅ",
                        "Âêõ„Å´„Å¥„Å£„Åü„Çä„ÅÆ‰∫∫„ÅåË¶ã„Å§„Åã„Çã„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„ÇàÔºÅ"
                    ]
                },
                {
                    name: "„Çπ„Éû„Éõ",
                    x: 500,
                    y: 200,
                    isQuizNPC: true,
                    dialogue: [
                        "„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Ç¢„Éó„É™„ÇíÈñã„ÅÑ„Å¶„ÅÑ„Åæ„Åô...",
                        "„Åä„Å£ÔºÅ„Éû„ÉÉ„ÉÅ„Åó„Åæ„Åó„ÅüÔºÅ",
                        "„ÇØ„Ç§„Ç∫: ‰∫å‰∫∫„ÅåÊúÄÂàù„Å´‰Ωø„Å£„Åü„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Ç¢„Éó„É™„ÅØÔºü"
                    ],
                    quiz: {
                        question: "‰∫å‰∫∫„ÅåÊúÄÂàù„Å´‰Ωø„Å£„Åü„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Ç¢„Éó„É™„ÅØÔºü",
                        options: ["Pairs", "Tinder", "Omiai", "With"],
                        correct: 0
                    }
                }
            ]
        },
        {
            name: "Stage 2: „É°„ÉÉ„Çª„Éº„Ç∏‰∫§Êèõ",
            bgColor: "#e3f2fd",
            npcs: [
                {
                    name: "„Éë„Éº„Éà„Éä„Éº",
                    x: 400,
                    y: 200,
                    isQuizNPC: true,
                    dialogue: [
                        "„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶ÔºÅ„Éó„É≠„Éï„Ç£„Éº„É´Ë¶ã„Åæ„Åó„Åü„ÄÇ",
                        "Ë∂£Âë≥„ÅåÂêà„ÅÑ„Åù„ÅÜ„Åß„Åô„Å≠ÔºÅ",
                        "„ÇØ„Ç§„Ç∫: ÊúÄÂàù„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅßË©±„Åó„ÅüË©±È°å„ÅØÔºü"
                    ],
                    quiz: {
                        question: "ÊúÄÂàù„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅßË©±„Åó„ÅüË©±È°å„ÅØÔºü",
                        options: ["Êò†Áîª„Å´„Å§„ÅÑ„Å¶", "ÊñôÁêÜ„Å´„Å§„ÅÑ„Å¶", "ÊóÖË°å„Å´„Å§„ÅÑ„Å¶", "Èü≥Ê•Ω„Å´„Å§„ÅÑ„Å¶"],
                        correct: 2
                    }
                }
            ]
        },
        {
            name: "Stage 3: Âàù„Éá„Éº„Éà",
            bgColor: "#fff3e0",
            npcs: [
                {
                    name: "„Ç´„Éï„ÇßÂ∫óÂì°",
                    x: 200,
                    y: 200,
                    dialogue: [
                        "„ÅÑ„Çâ„Å£„Åó„ÇÉ„ÅÑ„Åæ„ÅõÔºÅ",
                        "Á¥†Êïµ„Å™„Ç´„ÉÉ„Éó„É´„Åß„Åô„Å≠ÔºÅ",
                        "„Åî„ÇÜ„Å£„Åè„Çä„Å©„ÅÜ„Åû„ÄÇ"
                    ]
                },
                {
                    name: "„Éë„Éº„Éà„Éä„Éº",
                    x: 400,
                    y: 300,
                    isQuizNPC: true,
                    dialogue: [
                        "‰ªäÊó•„ÅØ‰ºö„Åà„Å¶Â¨â„Åó„ÅÑ„Åß„ÅôÔºÅ",
                        "Á∑äÂºµ„Åó„Å¶„Åæ„Åô„Åå„ÄÅÊ•Ω„Åó„Åø„Å´„Åó„Å¶„Åæ„Åó„Åü„ÄÇ",
                        "„ÇØ„Ç§„Ç∫: Âàù„Éá„Éº„Éà„ÅÆÂ†¥ÊâÄ„ÅØ„Å©„ÅìÔºü"
                    ],
                    quiz: {
                        question: "Âàù„Éá„Éº„Éà„ÅÆÂ†¥ÊâÄ„ÅØ„Å©„ÅìÔºü",
                        options: ["Ê∞¥ÊóèÈ§®", "ÈÅäÂúíÂú∞", "„Ç´„Éï„Çß", "Êò†ÁîªÈ§®"],
                        correct: 2
                    }
                }
            ]
        },
        {
            name: "Stage 4: „Éó„É≠„Éù„Éº„Ç∫",
            bgColor: "#fce4ec",
            npcs: [
                {
                    name: "„Éë„Éº„Éà„Éä„Éº",
                    x: 400,
                    y: 250,
                    isQuizNPC: true,
                    dialogue: [
                        "‰ªäÊó•„ÅØÂ§ßÂàá„Å™Ë©±„Åå„ÅÇ„Å£„Å¶...",
                        "„Åì„Çå„Åæ„Åß„ÅÆÊôÇÈñì„ÄÅÊú¨ÂΩì„Å´Âπ∏„Åõ„Åß„Åó„Åü„ÄÇ",
                        "„ÇØ„Ç§„Ç∫: „Éó„É≠„Éù„Éº„Ç∫„ÅÆË®ÄËëâ„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åü„Ç≠„Éº„ÉØ„Éº„Éâ„ÅØÔºü"
                    ],
                    quiz: {
                        question: "„Éó„É≠„Éù„Éº„Ç∫„ÅÆË®ÄËëâ„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åü„Ç≠„Éº„ÉØ„Éº„Éâ„ÅØÔºü",
                        options: ["Ê∞∏ÈÅ†„Å´‰∏ÄÁ∑í„Å´", "ÁµêÂ©ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "ÊÑõ„Åó„Å¶„Çã", "„Åô„Åπ„Å¶"],
                        correct: 1
                    }
                }
            ]
        }
    ];
    
    // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Ç∏
    let currentStage = stages[0];
    let currentNPCs = [];
    
    // „Ç≠„ÉºÂÖ•ÂäõÁÆ°ÁêÜ
    const keys = {};
    
    // „Ç≤„Éº„É†ÂàùÊúüÂåñ
    function init() {
        document.getElementById('startButton').addEventListener('click', startGame);
        document.getElementById('restartButton').addEventListener('click', restartGame);
        
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if ((e.key === ' ' || e.key === 'Enter') && !game.isQuizActive) {
                handleInteraction();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
    }
    
    function startGame() {
        document.getElementById('startScreen').style.display = 'none';
        game.currentStage = 0;
        game.score = 0;
        loadStage(0);
        gameLoop();
    }
    
    function restartGame() {
        document.getElementById('endScreen').style.display = 'none';
        startGame();
    }
    
    function loadStage(stageIndex) {
        currentStage = stages[stageIndex];
        currentNPCs = currentStage.npcs.map(npc => ({...npc}));
        player.x = 400;
        player.y = 400;
        
        // „Çπ„ÉÜ„Éº„Ç∏„Çø„Ç§„Éà„É´Ë°®Á§∫
        showStageTitle(currentStage.name);
    }
    
    function showStageTitle(title) {
        const titleElement = document.getElementById('stageTitle');
        titleElement.textContent = title;
        titleElement.style.display = 'block';
        
        setTimeout(() => {
            titleElement.style.display = 'none';
        }, 2000);
    }
    
    function handleInteraction() {
        if (game.isDialogueActive) {
            if (game.currentDialogue && game.dialogueIndex < game.currentDialogue.length - 1) {
                game.dialogueIndex++;
                showDialogue(game.currentDialogue[game.dialogueIndex], game.currentNPC.name);
            } else if (game.currentNPC && game.currentNPC.isQuizNPC && game.dialogueIndex === game.currentDialogue.length - 1) {
                showQuiz(game.currentNPC.quiz);
            } else {
                hideDialogue();
            }
            return;
        }
        
        // NPC„Å®„ÅÆË∑ùÈõ¢„ÉÅ„Çß„ÉÉ„ÇØ
        for (let npc of currentNPCs) {
            const distance = Math.sqrt(Math.pow(player.x - npc.x, 2) + Math.pow(player.y - npc.y, 2));
            if (distance < 60) {
                game.currentNPC = npc;
                game.currentDialogue = npc.dialogue;
                game.dialogueIndex = 0;
                showDialogue(npc.dialogue[0], npc.name);
                break;
            }
        }
    }
    
    function showDialogue(text, speaker) {
        game.isDialogueActive = true;
        const dialogueBox = document.getElementById('dialogueBox');
        const speakerName = document.getElementById('speakerName');
        const dialogueText = document.getElementById('dialogueText');
        
        dialogueBox.classList.add('active');
        speakerName.textContent = speaker;
        dialogueText.textContent = text;
        document.getElementById('quizOptions').style.display = 'none';
    }
    
    function hideDialogue() {
        game.isDialogueActive = false;
        game.currentNPC = null;
        game.currentDialogue = null;
        document.getElementById('dialogueBox').classList.remove('active');
    }
    
    function showQuiz(quiz) {
        game.isQuizActive = true;
        const quizOptions = document.getElementById('quizOptions');
        quizOptions.innerHTML = '';
        quizOptions.style.display = 'block';
        
        quiz.options.forEach((option, index) => {
            const button = document.createElement('button');
            button.className = 'quizButton';
            button.textContent = option;
            button.onclick = () => handleQuizAnswer(index, quiz.correct);
            quizOptions.appendChild(button);
        });
    }
    
    function handleQuizAnswer(selected, correct) {
        game.isQuizActive = false;
        
        if (selected === correct) {
            game.score++;
            showDialogue("Ê≠£Ëß£ÔºÅüíï „Çà„ÅèË¶ö„Åà„Å¶„Çã„Å≠ÔºÅ", "„Ç∑„Çπ„ÉÜ„É†");
        } else {
            showDialogue("ÊÆãÂøµÔºÅ„Åß„ÇÇÂ§ß‰∏àÂ§´„ÄÅÊÑõ„Åå„ÅÇ„Çå„Å∞ÔºÅ", "„Ç∑„Çπ„ÉÜ„É†");
        }
        
        setTimeout(() => {
            hideDialogue();
            
            // Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Å∏
            if (game.currentStage < stages.length - 1) {
                game.currentStage++;
                loadStage(game.currentStage);
            } else {
                // „Ç≤„Éº„É†„ÇØ„É™„Ç¢
                showEndScreen();
            }
        }, 2000);
    }
    
    function showEndScreen() {
        const endScreen = document.getElementById('endScreen');
        const finalScore = document.getElementById('finalScore');
        endScreen.style.display = 'flex';
        finalScore.textContent = `„Çπ„Ç≥„Ç¢: ${game.score} / ${game.totalQuestions} ÂïèÊ≠£Ëß£`;
    }
    
    function updatePlayer() {
        if (game.isDialogueActive) return;
        
        let moving = false;
        
        if (keys['ArrowUp'] || keys['w'] || keys['W']) {
            player.y -= player.speed;
            player.direction = 'up';
            moving = true;
        }
        if (keys['ArrowDown'] || keys['s'] || keys['S']) {
            player.y += player.speed;
            player.direction = 'down';
            moving = true;
        }
        if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
            player.x -= player.speed;
            player.direction = 'left';
            moving = true;
        }
        if (keys['ArrowRight'] || keys['d'] || keys['D']) {
            player.x += player.speed;
            player.direction = 'right';
            moving = true;
        }
        
        // ÁîªÈù¢Â¢ÉÁïå„ÉÅ„Çß„ÉÉ„ÇØ
        player.x = Math.max(player.width/2, Math.min(canvas.width - player.width/2, player.x));
        player.y = Math.max(player.height/2, Math.min(canvas.height - player.height/2, player.y));
        
        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Êõ¥Êñ∞
        if (moving) {
            player.frameCount++;
            if (player.frameCount > 10) {
                player.currentFrame = (player.currentFrame + 1) % 4;
                player.frameCount = 0;
            }
        } else {
            player.currentFrame = 0;
        }
        
        player.isMoving = moving;
    }
    
    function drawPlayer() {
        ctx.save();
        
        // „Éó„É¨„Ç§„É§„Éº„ÇíÁ∞°Âçò„Å™ÂΩ¢„ÅßÊèèÁîª
        ctx.fillStyle = '#4a90e2';
        ctx.fillRect(player.x - player.width/2, player.y - player.height/2, player.width, player.height);
        
        // È°î
        ctx.fillStyle = '#fdbcb4';
        ctx.beginPath();
        ctx.arc(player.x, player.y - player.height/4, 12, 0, Math.PI * 2);
        ctx.fill();
        
        // ÁõÆ
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(player.x - 4, player.y - player.height/4, 2, 0, Math.PI * 2);
        ctx.arc(player.x + 4, player.y - player.height/4, 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Âêë„ÅçË°®Á§∫
        ctx.strokeStyle = '#2c3e50';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        switch(player.direction) {
            case 'up':
                ctx.moveTo(player.x, player.y - player.height/2 - 10);
                ctx.lineTo(player.x - 5, player.y - player.height/2 - 5);
                ctx.moveTo(player.x, player.y - player.height/2 - 10);
                ctx.lineTo(player.x + 5, player.y - player.height/2 - 5);
                break;
            case 'down':
                ctx.moveTo(player.x, player.y + player.height/2 + 10);
                ctx.lineTo(player.x - 5, player.y + player.height/2 + 5);
                ctx.moveTo(player.x, player.y + player.height/2 + 10);
                ctx.lineTo(player.x + 5, player.y + player.height/2 + 5);
                break;
            case 'left':
                ctx.moveTo(player.x - player.width/2 - 10, player.y);
                ctx.lineTo(player.x - player.width/2 - 5, player.y - 5);
                ctx.moveTo(player.x - player.width/2 - 10, player.y);
                ctx.lineTo(player.x - player.width/2 - 5, player.y + 5);
                break;
            case 'right':
                ctx.moveTo(player.x + player.width/2 + 10, player.y);
                ctx.lineTo(player.x + player.width/2 + 5, player.y - 5);
                ctx.moveTo(player.x + player.width/2 + 10, player.y);
                ctx.lineTo(player.x + player.width/2 + 5, player.y + 5);
                break;
        }
        ctx.stroke();
        
        ctx.restore();
    }
    
    function drawNPC(npc) {
        // NPC„ÅÆ‰Ωì
        ctx.fillStyle = npc.isQuizNPC ? '#e91e63' : '#9c27b0';
        ctx.fillRect(npc.x - 16, npc.y - 24, 32, 48);
        
        // NPC„ÅÆÈ°î
        ctx.fillStyle = '#fdbcb4';
        ctx.beginPath();
        ctx.arc(npc.x, npc.y - 12, 12, 0, Math.PI * 2);
        ctx.fill();
        
        // ÁõÆ
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(npc.x - 4, npc.y - 12, 2, 0, Math.PI * 2);
        ctx.arc(npc.x + 4, npc.y - 12, 2, 0, Math.PI * 2);
        ctx.fill();
        
        // ÂêçÂâçË°®Á§∫
        ctx.fillStyle = '#000';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(npc.name, npc.x, npc.y - 40);
        
        // „ÇØ„Ç§„Ç∫NPC„Å´„ÅØÁâπÂà•„Å™„Éû„Éº„ÇØ
        if (npc.isQuizNPC) {
            ctx.fillStyle = '#ffd700';
            ctx.font = '20px Arial';
            ctx.fillText('ÔºÅ', npc.x, npc.y - 55);
        }
    }
    
    function draw() {
        // ËÉåÊôØ
        ctx.fillStyle = currentStage.bgColor;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // „Ç∞„É™„ÉÉ„ÉâÊ®°Êßò
        ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
        ctx.lineWidth = 1;
        for (let i = 0; i < canvas.width; i += 50) {
            ctx.beginPath();
            ctx.moveTo(i, 0);
            ctx.lineTo(i, canvas.height);
            ctx.stroke();
        }
        for (let i = 0; i < canvas.height; i += 50) {
            ctx.beginPath();
            ctx.moveTo(0, i);
            ctx.lineTo(canvas.width, i);
            ctx.stroke();
        }
        
        // NPCsÊèèÁîª
        currentNPCs.forEach(npc => drawNPC(npc));
        
        // „Éó„É¨„Ç§„É§„ÉºÊèèÁîª
        drawPlayer();
        
        // „Çπ„ÉÜ„Éº„Ç∏ÊÉÖÂ†±
        ctx.fillStyle = '#000';
        ctx.font = 'bold 16px Arial';
        ctx.textAlign = 'left';
        ctx.fillText(`Stage: ${game.currentStage + 1}/4`, 10, 30);
        ctx.fillText(`Score: ${game.score}/${game.totalQuestions}`, 10, 50);
    }
    
    function gameLoop() {
        updatePlayer();
        draw();
        requestAnimationFrame(gameLoop);
    }
    
    // „Ç≤„Éº„É†ÈñãÂßã
    init();
</script>
```

</body>
</html>
